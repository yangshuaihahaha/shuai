# 概述
在追求极致性能的场景下，了解你的应用程序运行过程中cpu都在干什么很重要，
火焰图就是一种非常直观的展示cpu在整个生命周期过程中时间分配的工具

火焰图（Flame Graph）是由Linux性能优化大师Brendan Gregg发明的，和所有其他的profiling方法不同
火焰图以一个全局的视野来看待时间分布，它从底部往顶部，列出所有可能导致性能瓶颈的调用

火焰图整个图形看起来就像一个跳动的火焰，这就是它名字的由来
火焰图有以下特征（这里以on-cpu火焰图为例）：
1，每一列代表一个调用栈，每一个格子代表一个函数
2，纵轴展示了栈的深度，按照调用关系从下到上排列。最顶上格子代表采样时，正在占用cpu的函数
3，横轴的意义是指：火焰图将采集的多个调用栈信息，通过按字母横向排序的方式将众多信息聚合在一起。需要注意的是他并不代表时间
4，横轴格子的宽度代表其在采样中出现的频率，所以一个格子的宽度越大，说明它是瓶颈的原因的可能性就越大
5，火焰图格子的颜色是随机的暖色调，方便区分各个调用信息。
6，其他的采样方式也可以使用火焰图，on-cpu火焰图横轴是指cpu占用时间，off-cpu火焰图横轴则代表阻塞时间
7，采样可以是单线程、多线程、多进程甚至是host，进阶用法可以参考附录进阶阅读

# 火焰图类型
常见的火焰图类型有On-CPU，还有Memory，Hot/Cold，Differential等等。那么他们分别适合处理什么样的问题呢？
火焰图类型               横轴含义                              纵轴含义                            解决问题                                             采样方式
cpu火焰图              cpu占用时间                            调用栈                 找出cpu占用高的问题函数；分析代码热路径                            固定频率采样cpu调用栈
off-cpu火焰图           阻塞时间                              调用栈            i/o、网络等阻塞场景导致的性能下降；锁竞争、死锁导致的性能下降             固定频率采样 阻塞事件调用栈
内存火焰图           内存申请/释放函数调用次数                    调用栈             内存泄漏问题；内存占用高的对象；虚拟内存或者物理内存泄漏问题    有四种方式：跟踪malloc/free；跟踪brk；跟踪错误网页
Hot/Cold火焰图  on-CPU火焰图和off-CPU火焰图结合在一起综合展示      调用栈        需要结合cpu占用以及阻塞分析的场景，off-CPU火焰图无法直观判断问题的场景      on-CPU火焰图和off-CPU火焰图结合

# 火焰图分析技巧
1，纵轴代表调用栈的深度（栈帧数），用于表示函数间调用关系；下面的函数是上面函数的父函数
2，横轴代表调用频次，一个格子的宽度越大，越说明其可能是瓶颈的原因
3，不同类型火焰图适合优化的场景不同，比如on-cpu火焰图适合分析cpu占用高的问题函数，off-cpu火焰图适合解决阻塞和锁抢占问题
4，无意义的事情：横向先后顺序是为聚合，跟函数间依赖或调用关系无关；火焰图各种颜色是为方便区分，本身不具有特殊含义
5，多联系：进行性能优化意识的使用火焰图的方式进行性能调优
